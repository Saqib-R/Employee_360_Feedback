

<!-- Summarisation Page Section -->
 <div *ngIf="data">
      <!-- Header Section -->
  <div
  class="container mt-0 px-4 py-2 bg-white rounded shadow d-flex gap-3 align-items-center w-100"
  >
  <div class="col-1">
    <!-- <img
      src="https://www.gravatar.com/avatar/2c7d99fe281ecd3bcd65ab915bac6dd5?s=250"
      width="200"
      height="200"
      alt="Profile"
      class="img-fluid rounded-circle"
    /> -->
    <img
      [src]="'https://eu.ui-avatars.com/api/?name=' + data?.subject + '&size=250'"
      width="200"
      height="200"
      alt="Profile"
      class="img-fluid rounded-circle"
  />
  </div>
  <div class="col-9">
    <h4>{{data?.subject}}</h4>
    <div class="d-flex flex-row gap-1 align-items-center">
      <span class="badge bg-secondary">{{data?.job_title}}</span>
      <span class="badge bg-light text-dark">{{data?.level}}</span>
      <span class="badge bg-dark-subtle text-dark">{{data?.function_code}}</span>
    </div>
  </div>
  </div>

  <div class="container mt-3 mb-4 p-4 bg-white rounded shadow position-relative">
  <!-- Main Section -->
  <div class="row align-items-center mb-4 border-bottom pb-3">
    <div class="col">
      <h5 class="text-primary fw-bold">
        Summarization for
        <span class="text-muted fs-5 fw-bold shadow-none">
          {{feedbackQuestionNo[questionNo]}}
        </span>
        <span class="text-muted fs-5 fw-medium shadow-none">
            {{ feedbackQuestion[questionNo] }}
        </span>
      </h5>
    </div>
    <!-- <div class="col-3 text-end">
      <button type="button" class="badge btn-primary text-dark px-3 py-2" (click)="reSummarize()">Re-Generate Summary</button>
    </div> -->
  </div>

  <!-- Summarization Response Section -->
  <!-- <div class="row mb-4" style="min-height: 39vh; ">
    <div class="col-12">
      <div class="card shadow-sm summarization-card">
        <div class="card-body">
          <h6 class="card-title text-primary mb-3">
            <i class="fas fa-lightbulb text-warning me-2"></i> Summarization
            Response
          </h6>
          <div class="summary-box">
            <p class="card-text text-muted summary-text">
              {{ summaryResponse }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <!-- New Summarisation Section -->
  <div class="container mt-5">
    <div class="row mb-2">
      <!-- First Table (Original Feedbacks) -->
      <div class="col-md-12 mb-4">
        <div class="card mt-3 shadow border-light rounded">

          <div class="card-body accordion-item bg-transparent border-bottom py-2 " style="width: 100%; margin: auto;"
          type="button" data-bs-toggle="collapse" (click)="toggleIcon()" [attr.data-bs-target]="'#faqAccountCollapse0'" aria-expanded="false" [attr.aria-controls]="'faqAccountCollapse0'">
            <h2 class="accordion-header py-1 d-flex justify-content-between align-items-center" [attr.id]="'faqAccountHeading0'">
              <button class="accordion-button collapsed bg-transparent fw-bold shadow-none link-primary" >

                <p class="d-flex align-items-center gap-2">
                  <i class="bi bi-list-nested fs-4"></i>
                  <span class="fs-5">Original Feedbacks</span>
                </p>
              </button>
              <div class="col-2 text-end">
                <i class="transition-icon" [ngClass]="{'bi-chevron-down': !isCollapsed, 'bi-chevron-up': isCollapsed}"></i>
              </div>
            </h2>
            <div *ngIf="questionNo !== 'all'" [attr.id]="'faqAccountCollapse0'" class="accordion-collapse collapse" style="margin-left: 1rem;" [attr.aria-labelledby]="'faqAccountHeading0'">
              <div class="accordion-body">
                <p *ngFor="let item of data?.[questionNo]; let i = index; let last = last"
                [ngClass]="{'border-bottom': !last, 'pb-1' : !last}"
                  style="margin-left: 7px;"
                  class="d-flex align-items-center gap-2 text-sm-start pb-1">
                  <!-- <i class="bi bi-dash" style="font-size: 1.5rem;"></i> -->
                  <span>
                    <strong>{{i+1}} - </strong>
                    {{item}}
                  </span>
                </p>
              </div>
            </div>


            <!-- IF all -->
            <div *ngIf="questionNo === 'all'" [attr.id]="'faqAccountCollapse0'" class="accordion-collapse collapse" style="margin-left: 1rem;" [attr.aria-labelledby]="'faqAccountHeading0'">
              <div class="accordion-body">
                <div class="tab-content p-3 border">


                  <div id="business-need" class="tab-pane active">
                    <div class="accordion" id="feedbackAccordion">

                      <div class="accordion-item ">
                        <h2 class="accordion-header" id="headingOne">
                          <button
                            class="accordion-button p-4 fw-bold fs-6"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseOne"
                            aria-expanded="true"
                            aria-controls="collapseOne"
                          >
                            1. Please provide a few examples of this individual's greatest
                            achievements and/or contributions this year from your perspective.
                          </button>
                        </h2>
                        <div
                          id="collapseOne"
                          class="accordion-collapse collapse show"
                          aria-labelledby="headingOne"
                          data-bs-parent="#feedbackAccordion"
                        >
                          <div class="accordion-body">
                            <div class="feedback-list">
                              <p
                                *ngFor="
                                  let item of data?.question1;
                                  let i = index;
                                  let last = last
                                "
                                [ngClass]="{ 'border-bottom': !last, 'pb-1': !last }"
                                style="margin-left: 7px"
                                class="d-flex align-items-center gap-2 text-sm-start pb-1"
                              >
                                <!-- <i
                                  class="bi bi-arrow-right-short"
                                  style="font-size: 1.5rem"
                                ></i> -->
                                <span>
                                  <strong>{{i+1}} - </strong>
                                   {{ item }}
                                </span>
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="accordion-item ">
                        <h2 class="accordion-header" id="headingTwo">
                          <button
                            class="accordion-button collapsed p-4 fw-bold fs-6"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseTwo"
                            aria-expanded="false"
                            aria-controls="collapseTwo"
                          >
                            2. How has this individual demonstrated CustomerOrg's cultural
                            values, according to the Career Framework? Please provide a few
                            examples.
                          </button>
                        </h2>
                        <div
                          id="collapseTwo"
                          class="accordion-collapse collapse"
                          aria-labelledby="headingTwo"
                          data-bs-parent="#feedbackAccordion"
                        >
                          <div class="accordion-body">
                            <div class="feedback-list">
                              <p
                                *ngFor="
                                  let item of data?.question2;
                                  let i = index;
                                  let last = last
                                "
                                [ngClass]="{ 'border-bottom': !last, 'pb-1': !last }"
                                style="margin-left: 7px"
                                class="d-flex align-items-center gap-2 text-sm-start pb-1"
                              >
                                <!-- <i
                                  class="bi bi-arrow-right-short"
                                  style="font-size: 1.5rem"
                                ></i> -->
                                <span>
                                  <strong>{{i + data?.question1.length + 1}} - </strong>
                                  {{ item }}
                                </span>
                              </p>
                            </div>

                          </div>
                        </div>
                      </div>

                      <div class="accordion-item ">
                        <h2 class="accordion-header " id="headingThree">
                          <button
                            class="accordion-button collapsed p-4 fw-bold fs-6"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseThree"
                            aria-expanded="false"
                            aria-controls="collapseThree"
                          >
                            3. What skills or capabilities can this individual build or expand
                            upon that would allow the individual to contribute even more value
                            in the future?
                          </button>
                        </h2>
                        <div
                          id="collapseThree"
                          class="accordion-collapse collapse"
                          aria-labelledby="headingThree"
                          data-bs-parent="#feedbackAccordion"
                        >
                          <div class="accordion-body">
                            <div class="feedback-list">
                              <p
                                *ngFor="
                                  let item of data?.question3;
                                  let i = index;
                                  let last = last
                                "
                                [ngClass]="{ 'border-bottom': !last, 'pb-1': !last }"
                                style="margin-left: 7px"
                                class="d-flex align-items-center gap-2 text-sm-start pb-1"
                              >
                                <!-- <i
                                  class="bi bi-arrow-right-short"
                                  style="font-size: 1.5rem"
                                ></i> -->
                                <span>
                                  <strong>{{i + data?.question1.length + data?.question2.length + 1}} - </strong>
                                  {{ item }}
                                </span>
                              </p>
                            </div>


                          </div>
                        </div>
                      </div>

                      <div class="accordion-item ">
                        <h2 class="accordion-header fw-bold" id="headingFour">
                          <button
                            class="accordion-button collapsed p-4 fw-bold fs-6"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseFour"
                            aria-expanded="false"
                            aria-controls="collapseFour"
                          >
                            4. What skills should this individual focus on developing in the
                            future to progress to the next level (if applicable)? Please refer
                            to the Career Framework to review the expected results and
                            behaviors at the next level.
                          </button>
                        </h2>
                        <div
                          id="collapseFour"
                          class="accordion-collapse collapse"
                          aria-labelledby="headingFour"
                          data-bs-parent="#feedbackAccordion"
                        >
                          <div class="accordion-body">

                            <div class="feedback-list">
                              <p
                                *ngFor="
                                  let item of data?.question4;
                                  let i = index;
                                  let last = last
                                "
                                [ngClass]="{ 'border-bottom': !last, 'pb-1': !last }"
                                style="margin-left: 7px"
                                class="d-flex align-items-center gap-2 text-sm-start pb-1"
                              >
                                <!-- <i
                                  class="bi bi-arrow-right-short"
                                  style="font-size: 1.5rem"
                                ></i> -->
                                <span>
                                  <strong>{{i + data?.question1.length + data?.question2.length + data?.question3.length + 1}} - </strong>
                                   {{ item }}
                                </span>
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- <div class="card-body">
            <h6 class="card-title text-primary mb-3">
              <i class="fas fa-comments text-info me-2"></i> Original Feedbacks
            </h6>
            <div class="table-responsive">
              <table class="table table-striped table-bordered">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Feedback</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Great at decision-making and proactive.</td>
                  </tr>
                  <tr>
                    <td>Needs improvement in communication skills.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div> -->
        </div>
      </div>

      <!-- Second Table (Summary 1) -->
      <div class="col-md-12 mb-4" >
        <div class="card shadow border-light rounded " >
          <div class="card-body">
            <!-- <h6 class="card-title text-success mb-3">
              <i class="fas fa-lightbulb text-warning me-2"></i> Summary 1
              Response
            </h6> -->
            <div class="table-responsive " style="height: 100%;">
              <table class="table table-striped table-bordered" style="height: 93%;">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="d-flex align-items-center gap-1">
                      <i class="bi bi-lightbulb text-warning me-2"></i>
                      <span class="text-success">Generated Summary</span>
                    </th>
                  </tr>
                </thead>
                <tbody>

                  <tr>
                    <td>
                      <div *ngIf="GenLoading" class="d-flex gap-2 flex-column justify-content-center align-items-center">
                        <span>Loading summaries...</span>
                        <span class="loader text-primary"></span>
                      </div>  <!-- Loading message -->

                      <div *ngIf="!GenLoading" style="justify-content: start;">
                        <p style="text-wrap: wrap;">{{ text || 'Error while fetching response from the model. \nPlease try again later.' }}</p>
                        <!-- <p *ngFor="let paragraph of summaries[0].split('\n')" [innerHTML]="formatText(paragraph)"></p> -->

                        <div class="d-flex align-items-center">
                          <!-- Copy Button -->
                          <button
                            class="btn btn-link text-muted"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Copy summary"
                            (click)="copyToClipboard(text)">
                            <i class="bi" [ngClass]="isCopied ? 'bi-check2' : 'bi-clipboard'" style="font-size: 1.1rem;"></i>
                          </button>

                          <!-- Re-Generate Button -->
                          <button
                            class="btn btn-link text-muted"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Re-Generate Summary">
                            <i class="bi bi-arrow-repeat" (click)="reSummarize()" style="font-size: 1.1rem;"></i>
                          </button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-12 d-flex justify-content-center my-3">
        <button class="btn btn-primary px-4 py-2" (click)="getExpecSummary()">
          <i class="bi bi-file-earmark-text-fill me-2"></i> Generate Expectation Summary
        </button>
      </div>

      <!-- Third Table (Summary 2) -->
      <div *ngIf="ExpecSummary" class="col-md-12 mb-4" >
        <div class="card shadow border-light rounded " >
          <div class="card-body">
            <!-- <h6 class="card-title text-success mb-3">
              <i class="fas fa-lightbulb text-warning me-2"></i> Summary 1
              Response
            </h6> -->
            <div class="table-responsive " style="height: 100%;">
              <table class="table table-striped table-bordered" style="height: 93%;">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="d-flex align-items-center gap-1">
                      <i class="bi bi-lightbulb text-warning me-2"></i>
                      <span class="text-success">Summary against {{data?.job_title}} expectations.</span>
                    </th>
                  </tr>
                </thead>
                <tbody>

                  <tr>
                    <td>
                      <div *ngIf="ExpSumLoading" class="d-flex gap-2 flex-column justify-content-center align-items-center">
                        <span>Loading summaries...</span>
                        <span class="loader text-primary"></span>
                      </div>  <!-- Loading message -->

                      <div *ngIf="!ExpSumLoading" style="justify-content: start;">
                        <!-- <p>{{ ExpecSummary || 'Error while fetching response from the model. \nPlease try again later.' }}</p> -->

                        <app-expectation-summary *ngFor="let item of summaryKeys" [key]="item" [summary]="ExpecSummary.summaries[item]" [rating]="ExpecSummary.ratings[item]"></app-expectation-summary>
                        <div class="d-flex align-items-center">
                          <!-- Copy Button -->
                          <button
                            class="btn btn-link text-muted"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Copy summary"
                            (click)="copyToClipboard(text)">
                            <i class="bi" [ngClass]="isCopied ? 'bi-check2' : 'bi-clipboard'" style="font-size: 1.1rem;"></i>
                          </button>

                          <!-- Re-Generate Button -->
                          <!-- <button
                            class="btn btn-link text-muted"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Re-Generate Summary">
                            <i class="bi bi-arrow-repeat" (click)="reSummarize()" style="font-size: 1.1rem;"></i>
                          </button> -->
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>

     <!-- Summarization Response Section -->
    <div *ngIf="customSummary" class="row mb-4">

      <div class="col-md-12 mb-4" >
        <div class="card shadow border-light rounded " >
          <div class="card-body">
            <!-- <h6 class="card-title text-success mb-3">
              <i class="fas fa-lightbulb text-warning me-2"></i> Summary 1
              Response
            </h6> -->
            <div class="table-responsive " style="height: 100%;">
              <table class="table table-striped table-bordered" style="height: 93%;">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="d-flex align-items-center gap-1">
                      <i class="bi bi-gear-wide-connected text-warning me-2"></i>
                      <span class="text-success">Custom Generated Summary</span>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div *ngIf="CustLoading" class="d-flex gap-2 flex-column justify-content-center align-items-center">
                        <span>Loading summaries...</span>
                        <span  class="loader text-primary"></span>
                      </div>
                      <div *ngIf="!CustLoading" style="justify-content: start;">
                        <p>{{ cusText || 'Error while fetching response from the model. \nPlease try again later.' }}</p>
                        <button
                            class="btn btn-link text-muted"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Copy summary"
                            (click)="copyToClipboard(text)">
                            <i class="bi" [ngClass]="isCopied ? 'bi-check2' : 'bi-clipboard'" style="font-size: 1.1rem;"></i>
                        </button>
                      </div>
                    </td>
                  </tr>

                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- <div class="col-12">
        <div class="card shadow-sm summarization-card">
          <div class="card-body">
            <h6 class="card-title text-primary mb-3 fs-5">
              <i class="bi bi-gear-wide-connected me-2"></i> Custom Prompt Response
            </h6>
            <div class="summary-box">
              <p class="card-text text-muted summary-text">
                {{ customSummary }}
              </p>
            </div>
          </div>
        </div>
      </div> -->
    </div>
  </div>

  <!-- Prompt Input Section -->
  <div class="row mt-4" style="position: sticky; bottom: 0">
    <div class="col-12">
      <!-- <h6>Provide a Custom Prompt:</h6> -->
      <div class="chat-input-group">
        <textarea
          class="form-control prompt-textarea"
          rows="2"
          placeholder="Enter your custom prompt..."
          (input)="adjustTextareaHeight($event)"
          [(ngModel)]="prompt"
          (keydown)="handleKeyDown($event)"
        ></textarea>
        <button
          class="btn btn-primary rounded-circle chat-submit-btn"
          (click)="submitPrompt()"
        >
          <i class="bi bi-arrow-up-short"></i>
        </button>
      </div>
    </div>
  </div>
  </div>
 </div>

 <app-no-feedbacks *ngIf="!data"></app-no-feedbacks>
